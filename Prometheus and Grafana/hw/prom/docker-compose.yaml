version: "3.8"
  
services:
    prometheus:
        image: prom/prometheus
        ports:
            - 9090:9090
        volumes:
            #- "./prometheus:/etc/prometheus"
            - "prometheus_data:/prometheus"
        command:
            - '--config.file=/etc/prometheus/prometheus.yml'
            - '--storage.tsdb.path=/prometheus'
            - '--web.console.libraries=/usr/share/prometheus/console_libraries'
            - '--web.console.templates=/usr/share/prometheus/consoles'
        links:
            - alertmanager:alertmanager
        networks:
            - back-tier
        restart: always
    
    alertmanager:
        image: prom/alertmanager
        ports:
          - 9093:9093
        volumes:
          - ./alertmanager:/etc/alertmanager/
        networks:
          - back-tier
        restart: always
        command:
          - '--config.file=/etc/alertmanager/config.yml'
          - '--storage.path=/alertmanager'
      
    grafana:
        image: grafana/grafana
        depends_on:
          - prometheus
        ports:
          - 3000:3000
        volumes:
          - grafana_data:/var/lib/grafana
          #- "./grafana:/var/lib/grafana"
        networks:
          - back-tier
          - front-tier
        restart: always

volumes:
  grafana_data:
  prometheus_data:
  
networks:
  front-tier:
  back-tier:
